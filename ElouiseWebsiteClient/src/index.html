<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>ElouiseWebsite</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
	<link rel="stylesheet" href="styles.css">
	<script>
const fclogo = {};

Object.defineProperty(fclogo, 'defaultSettings', {enumerable: true, value: 
	Object.freeze({
	borderSegmentTMod: -0.2,
	rotateSpeed: 0.4,
	borderRectHeight: 6,
	borderRectWidthAdjust: -2.5,
	borderRadius: 50,
	colorPalate: Object.freeze([ 'red', 'black' ]),
	numBlocks: 8,
	textRadius: 15,
	textHeight: 20,
	textSize: 5,
	debug: false,
	keyFrames: Object.freeze([
		Object.freeze({v: 0, t: 0}),
		Object.freeze({v: 6.28, t: 1}),
	]),
	})
});

/*
 * support utilities
 */
Object.defineProperty(fclogo, 'lerp', {value:
	Object.seal(function(v1, v2, t) {
		return (1-t) * v1+t * v2;
	})
});

Object.defineProperty(fclogo, 'wrap', {value: 
	Object.seal(function(value, min, max) {
		var rangeDiff = max - min;
		var valueToRange = value - min;
		var rangeOffset = valueToRange%rangeDiff;
		if ( valueToRange < 0 ) {
			rangeOffset+=rangeDiff;
		}
		return min+rangeOffset;
	})
});

Object.defineProperty(fclogo, 'clamp', {value: 
	Object.seal(function(v, min, max) {
		return Math.min(max, Math.max(v, min));
	})
});

Object.defineProperty(fclogo, 'KeyFrames', {value: 
	function() {
		Object.defineProperty(this, '_frames', {value: []});
		Object.seal(this);
	}
});
Object.defineProperty(fclogo.KeyFrames, 'prototype', {value: {}});
Object.seal(fclogo.KeyFrames);

Object.defineProperty(fclogo.KeyFrames.prototype, 'next', {enumerable: true, value: 
	Object.seal(function(oldT, dt) {
		let t =	fclogo.clamp(oldT+dt, this._frames[0].t, this._frames[this._frames.length-1].t);
		let frameIndex = null;
		for( let i = 1; i < this._frames.length; i++ ) {
			if ( t >= this._frames[i-1].t && t <= this._frames[i].t ) {
				frameIndex = i;
				break;
			}
		}

		let v = fclogo.lerp( this._frames[frameIndex-1].v, this._frames[frameIndex].v, t );

		return {
			t: t,
			v: v,
		};
	})
});

Object.defineProperty(fclogo.KeyFrames.prototype, 'newFrame', {enumerable: true, value:
	Object.seal(function(v, t) {
		this._frames.push( { v: v, t: t } );
	})
});
Object.seal(fclogo.KeyFrames.prototype);


Object.defineProperty(fclogo, 'Vector2', {value:
	function(x, y) {
		Object.defineProperty(this, 'x', {enumerable: true, writable: true, value: x});
		Object.defineProperty(this, 'y', {enumerable: true, writable: true, value: y});
		Object.seal(this);
	}
});
Object.defineProperty(fclogo.Vector2, 'prototype', {value: {} });
Object.seal(fclogo.Vector2);

Object.defineProperty(fclogo.Vector2.prototype, 'mag', {enumerable: true, value:
	Object.seal(function() {
		return Math.sqrt( Math.pow(this.x, 2) + Math.pow(this.y, 2) );
	})
});
Object.defineProperty(fclogo.Vector2.prototype, 'sub', {enumerable: true, value:
	Object.seal(function(v) {
		return new fclogo.Vector2(v.x-this.x, v.y-this.y);
	})
});
Object.defineProperty(fclogo.Vector2.prototype, 'rotate', {enumerable: true, value:
	Object.seal(function(angle) {
		return new fclogo.Vector2(this.x*Math.cos(angle)-this.y*Math.sin(angle), this.x*Math.sin(angle)+this.y*Math.cos(angle));
	})
});
Object.defineProperty(fclogo.Vector2.prototype, 'scale', {enumerable: true, value:
	Object.seal(function(s) {
		return new fclogo.Vector2(this.x*s, this.y*s);
	})
});
Object.defineProperty(fclogo.Vector2.prototype, 'add', {enumerable: true, value:
	Object.seal(function(v) {
		return new fclogo.Vector2(this.x+v.x, this.y+v.y);
	})
});

Object.defineProperty(fclogo.Vector2.prototype, 'equals', {enumerable: true, value:
	Object.seal(function(v) {
		return this.x == v.x && this.y == v.y;
	})
});
Object.seal(fclogo.Vector2.prototype);


Object.defineProperty(fclogo, 'Logo', {enumerable: true, value: 
	function(rootNode, styleClassName, settings) {
		Object.defineProperty(this, '_canvas', {value: document.createElement('canvas') });
		this._canvas.className = styleClassName;
		this._canvas.setAttribute('width', this._defaultScale.x);
		this._canvas.setAttribute('height', this._defaultScale.y);
		Object.defineProperty(this, '_ctx', {value: this._canvas.getContext('2d')});
		rootNode.appendChild(this._canvas);

		Object.defineProperty(this, '_settings', { value: !settings ? fclogo.defaultSettings : Object.freeze(settings) });
		Object.defineProperty(this, '_keyFrames', { value: new fclogo.KeyFrames() });
		Object.defineProperty(this, '_elementsT', { writable: true, value: new Array(this._settings.numBlocks).fill(0)});
		Object.defineProperty(this, '_textT', {writable: true, value: 0});
		Object.defineProperty(this, '_elementR', {writable: true,  value: 0});
		Object.defineProperty(this, '_numLoops', { value: Math.floor( (this._settings.rotateSpeed + this._settings.borderSegmentTMod)*10 )/2});
		Object.defineProperty(this, '_canvasSize', { writable: true, value: new fclogo.Vector2(this._defaultScale.x, this._defaultScale.y)});
		Object.defineProperty(this, '_lastCanvasSize', { writable: true, value: new fclogo.Vector2(this._defaultScale.x, this._defaultScale.y)});
		Object.defineProperty(this, '_scale', { writable: true, value: new fclogo.Vector2(1, 1)});

		Object.defineProperty(this, '_angleStep', { value: (Math.PI*2)/this._settings.numBlocks});

		let p1 = new fclogo.Vector2(0, 1).scale(this._settings.borderRadius);
		let p2 = p1.rotate(this._angleStep);
		let dir = p1.sub(p2);
		Object.defineProperty(this, '_borderRectWidth', { value: dir.mag()+this._settings.borderRectWidthAdjust});
		Object.defineProperty(this, '_rectRadius', { value: p1.add(dir.scale(0.5)).mag()});

		setupFrames = (settingsProp, keyFramesProp) => this._settings[settingsProp].forEach( frame => this[keyFramesProp].newFrame(frame.v, frame.t) );
		setupFrames('keyFrames', '_keyFrames');

		Object.seal(this);
	}
});
Object.defineProperty(fclogo.Logo, 'prototype', {value: {}});
Object.seal(fclogo.Logo);

Object.defineProperty(fclogo.Logo.prototype, '_defaultScale', {value:
	Object.freeze({
		x: 100,
		y: 100,
	})
});

Object.defineProperty(fclogo.Logo.prototype, 'drawRect', {value: 
	Object.seal(function(sizex, sizey, color) {
		this._ctx.fillStyle = color;
		this._ctx.fillRect(0, 0, sizex, sizey);
	})
});

Object.defineProperty(fclogo.Logo.prototype, 'drawText', {value:
	Object.seal(function(text, color, size) {
		this._ctx.save();
		this._ctx.fillStyle = color;
		this._ctx.textAlign = 'center';
		this._ctx.baseline = 'middle';
		this._ctx.scale(size, size);
		this._ctx.fillText(text, 0, 0);
		this._ctx.restore();
	})
});

Object.defineProperty(fclogo.Logo.prototype, 'drawBorderRect', {value:
	Object.seal(function(indexT, dt, color) {
		let frame = this._keyFrames.next( this._elementsT[indexT], dt * this._settings.rotateSpeed + dt * this._settings.borderSegmentTMod / this._settings.numBlocks * indexT );
		this._elementsT[indexT] = frame.t;
		this._ctx.save();
		this._ctx.rotate(this._angleStep*indexT);
		this._ctx.rotate(frame.v);
		this._ctx.translate(-this._borderRectWidth/2, this._settings.borderRectHeight/2);
		this._ctx.translate(0, -this._rectRadius);
		this.drawRect(this._borderRectWidth, this._settings.borderRectHeight, this._settings.colorPalate[color]);
		this._ctx.restore();
	})
});

Object.defineProperty(fclogo.Logo.prototype, 'drawFC', {value:
	Object.seal(function(dt) {
		//let frame = this._keyFrames.next( this._textT, dt * this._settings.rotateSpeed + dt * this._settings.borderSegmentTMod / this._settings.numBlocks * this._settings.numBlocks);
		//this._textT = frame.t;
		this._ctx.save();
		//this._ctx.rotate(frame.v);
		this._ctx.translate(0, this._settings.textHeight);
		this._ctx.translate(-this._settings.textRadius, 0);
		this.drawText('F', this._settings.colorPalate[0], this._settings.textSize);
		this._ctx.translate(this._settings.textRadius*2, 0);
		this.drawText('C', this._settings.colorPalate[1], this._settings.textSize);
		this._ctx.restore();

	})
});

Object.defineProperty(fclogo.Logo.prototype, 'draw', {value:
	Object.seal(function(dt) {
		this._ctx.setTransform(1, 0, 0, 1, 0, 0);
		this.updateCanvasSize();
		this._ctx.clearRect(0, 0, this._canvasSize.x, this._canvasSize.y);

		this._ctx.translate(this._canvasSize.x/2, this._canvasSize.y/2);
		this._ctx.scale(this._scale.x, this._scale.y);

		//Black first
		for( let i = 1; i < this._settings.numBlocks ; i+=2 ) {
			this.drawBorderRect(i, dt, i % 2);
		}
		//Red On top
		for( let i = 0; i < this._settings.numBlocks ; i+=2 ) {
			this.drawBorderRect(i, dt, i % 2);
		}

		//Text
		this.drawFC(dt);

		//Loop Animation
		let markIndex = this._elementsT.length-1;
		if ( this._elementR < this._numLoops ) {
			//Reset Mark 1 loop
			if ( this._elementsT[markIndex] >= this._settings.keyFrames[1].t ) {
				this._elementsT[markIndex] = 0;
				this._elementR++;
			}
			//Continue Advancing
			for( let i = 0; i < this._elementsT.length-1; i++ ) {
				if ( this._elementsT[i] >= this._settings.keyFrames[1].t ) {
					this._elementsT[i] = 0;
				}
			}
		}
		else {
			//Wait until all blocks stopped then reset
			if ( this._elementsT.every( e => e >= this._settings.keyFrames[1].t ) ) {
				this.reset();
			}
		}

		//debug Centre Square
		if ( this._settings.debug ) {
			this._ctx.save();
			this._ctx.translate(-2.5, -2.5);
			this._ctx.fillStyle = 'red';
			this._ctx.fillRect(0, 0, 5, 5);
			this._ctx.restore();
		}
	})
});

Object.defineProperty(fclogo.Logo.prototype, 'reset', {value:
	Object.seal(function() {
		this._elementsT = new Array(this._settings.numBlocks).fill(0);
		this._elementR = 0;
	})
});

Object.defineProperty(fclogo.Logo.prototype, 'updateCanvasSize', {value:
	function() {
		let style = window.getComputedStyle(this._canvas);
		this._lastCanvasSize = this._canvasSize;
		this._canvasSize = new fclogo.Vector2(parseInt(style.getPropertyValue('width')), parseInt(style.getPropertyValue('height')));
		if ( !this._lastCanvasSize.equals(this._canvasSize) ) {
			this._canvas.setAttribute('width', this._canvasSize.x);
			this._canvas.setAttribute('height', this._canvasSize.y);
			this._scale = new fclogo.Vector2(this._canvasSize.x/this._defaultScale.x, this._canvasSize.y/this._defaultScale.y);
		}
	}
});

Object.defineProperty(fclogo.Logo.prototype, 'render', {enumerable: true, value:
	Object.seal(function(dt) {
		this.draw(dt);
	})
});


Object.seal(fclogo.Logo.prototype);
Object.seal(fclogo);
	</script>
</head>
<body>
  <app-root>Loading...</app-root>
</body>
</html>
